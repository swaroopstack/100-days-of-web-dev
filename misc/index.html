<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Simple Habit Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 24px;
    }

    .container {
      width: 100%;
      max-width: 700px;
      background: #020617;
      border-radius: 16px;
      padding: 20px 24px 28px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
      border: 1px solid #1f2937;
    }

    h1 {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 0.9rem;
      color: #9ca3af;
      margin-bottom: 16px;
    }

    .today-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding: 12px 14px;
      border-radius: 12px;
      background: #020617;
      border: 1px solid #1f2937;
    }

    .today-text {
      font-size: 0.95rem;
    }

    .today-date {
      font-size: 0.8rem;
      color: #6b7280;
      margin-top: 2px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      background: #22c55e;
      color: #022c22;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.12s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(34, 197, 94, 0.35);
      background: #16a34a;
    }

    button:disabled {
      background: #374151;
      color: #9ca3af;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .status-text {
      font-size: 0.85rem;
      color: #22c55e;
      margin-top: 4px;
    }

    .grid {
      display: grid;
      grid-template-columns: 2fr 1.4fr;
      gap: 18px;
      margin-top: 10px;
    }

    .card {
      background: #020617;
      border-radius: 14px;
      border: 1px solid #1f2937;
      padding: 12px 12px 16px;
    }

    .card h2 {
      font-size: 1rem;
      margin-bottom: 8px;
    }

    .card-sub {
      font-size: 0.8rem;
      color: #6b7280;
      margin-bottom: 8px;
    }

    #historyList {
      list-style: none;
      max-height: 220px;
      overflow-y: auto;
      padding-right: 4px;
      font-size: 0.9rem;
    }

    #historyList li {
      padding: 5px 0;
      border-bottom: 1px dashed #1f2937;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .badge {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #022c22;
      color: #6ee7b7;
      border: 1px solid #15803d;
    }

    .empty-text {
      font-size: 0.85rem;
      color: #6b7280;
      margin-top: 4px;
    }

    @media (max-width: 700px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Habit Tracker</h1>
    <p class="subtitle">Track if you completed your habit each day. Data is saved in your browser.</p>

    <div class="today-row">
      <div>
        <div class="today-text">Did you complete your habit today?</div>
        <div class="today-date" id="todayDateText"></div>
        <div class="status-text" id="statusText"></div>
      </div>
      <button id="markTodayBtn">Mark Today as Done</button>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Last 7 Days</h2>
        <p class="card-sub">1 = done, 0 = not done</p>
        <canvas id="habitChart" height="180"></canvas>
      </div>

      <div class="card">
        <h2>History</h2>
        <p class="card-sub">All days you completed the habit</p>
        <ul id="historyList"></ul>
        <p class="empty-text" id="emptyHistoryText">No days tracked yet.</p>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "habit_dates"; // stores array of 'YYYY-MM-DD'
    const markTodayBtn = document.getElementById("markTodayBtn");
    const todayDateText = document.getElementById("todayDateText");
    const statusText = document.getElementById("statusText");
    const historyList = document.getElementById("historyList");
    const emptyHistoryText = document.getElementById("emptyHistoryText");
    const chartCanvas = document.getElementById("habitChart");
    let chartInstance = null;

    function formatDateDisplay(date) {
      return date.toLocaleDateString("en-IN", {
        day: "2-digit",
        month: "short",
        year: "numeric",
      });
    }

    function toKey(date) {
      // YYYY-MM-DD
      return date.toISOString().slice(0, 10);
    }

    function loadDates() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed;
      } catch (e) {
        console.error("Error reading storage", e);
        return [];
      }
    }

    function saveDates(dates) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(dates));
    }

    function renderHistory(dates) {
      historyList.innerHTML = "";
      if (dates.length === 0) {
        emptyHistoryText.style.display = "block";
        return;
      }
      emptyHistoryText.style.display = "none";

      // Sort descending (latest first)
      const sorted = [...dates].sort((a, b) => (a < b ? 1 : -1));

      for (const dateStr of sorted) {
        const li = document.createElement("li");
        const d = new Date(dateStr);
        li.innerHTML = `
          <span>${formatDateDisplay(d)}</span>
          <span class="badge">Done</span>
        `;
        historyList.appendChild(li);
      }
    }

    function renderChart(dates) {
      const today = new Date();
      const labels = [];
      const values = [];

      const dateSet = new Set(dates); // for quick lookup

      for (let i = 6; i >= 0; i--) {
        const d = new Date(today);
        d.setDate(today.getDate() - i);
        const key = toKey(d);
        labels.push(d.toLocaleDateString("en-IN", { day: "2-digit", month: "short" }));
        values.push(dateSet.has(key) ? 1 : 0);
      }

      if (chartInstance) {
        chartInstance.destroy();
      }

      chartInstance = new Chart(chartCanvas, {
        type: "bar",
        data: {
          labels,
          datasets: [
            {
              label: "Habit Done (Last 7 Days)",
              data: values,
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1,
                max: 1,
              },
            },
          },
        },
      });
    }

    function init() {
      const today = new Date();
      todayDateText.textContent = formatDateDisplay(today);

      let dates = loadDates();

      const todayKey = toKey(today);
      const alreadyDone = dates.includes(todayKey);
      if (alreadyDone) {
        markTodayBtn.disabled = true;
        statusText.textContent = "Already marked as done for today.";
      } else {
        statusText.textContent = "";
      }

      renderHistory(dates);
      renderChart(dates);

      markTodayBtn.addEventListener("click", () => {
        const now = new Date();
        const key = toKey(now);
        dates = loadDates(); // reload in case of changes
        if (!dates.includes(key)) {
          dates.push(key);
          saveDates(dates);
        }

        markTodayBtn.disabled = true;
        statusText.textContent = "Marked as done for today.";
        renderHistory(dates);
        renderChart(dates);
      });
    }

    init();
  </script>
</body>
</html>
